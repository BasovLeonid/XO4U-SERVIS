# Структура проекта XO4U-SERVIS

## Структура папки app

### Models
- `app/Models/`
  - `DirectTemplate.php`
    - Свойства:
      - `name` - название шаблона
      - `description` - описание шаблона
      - `status` - статус шаблона
      - `type` - тип шаблона
      - `settings` - настройки шаблона (JSON)
      - `user_id` - ID владельца
    - Отношения:
      - `user()` - связь с пользователем
      - `campaigns()` - связь с кампаниями
    - Методы:
      - `scopeActive()` - область видимости активных шаблонов
      - `scopeByUser()` - фильтрация по пользователю
      - `getSettingsAttribute()` - получение настроек
      - `setSettingsAttribute()` - установка настроек
      - `validateSettings()` - валидация настроек
      - `canBeEdited()` - проверка возможности редактирования
      - `getStatistics()` - получение статистики использования

  - `DirectTemplatesCampaign.php`
    - Свойства:
      - `name` - название кампании
      - `status` - статус кампании
      - `type` - тип кампании
      - `budget` - бюджет кампании
      - `strategy` - стратегия кампании
      - `platforms` - платформы показа (JSON)
      - `schedule` - расписание (JSON)
      - `restrictions` - ограничения (JSON)
      - `corrections` - корректировки (JSON)
      - `additional_settings` - дополнительные настройки (JSON)
      - `template_id` - ID шаблона
    - Отношения:
      - `template()` - связь с шаблоном
      - `sections()` - связь с разделами
      - `logs()` - связь с логами
    - Методы:
      - `scopeActive()` - область видимости активных кампаний
      - `scopeByTemplate()` - фильтрация по шаблону
      - `getPlatformsAttribute()` - получение платформ
      - `setPlatformsAttribute()` - установка платформ
      - `getScheduleAttribute()` - получение расписания
      - `setScheduleAttribute()` - установка расписания
      - `validateStrategy()` - валидация стратегии
      - `validatePlatforms()` - валидация платформ
      - `validateBudget()` - валидация бюджета
      - `getStatistics()` - получение статистики
      - `syncWithYandex()` - синхронизация с Яндекс.Директ
      - `exportData()` - экспорт данных
      - `importData()` - импорт данных

  - `DirectTemplatesCampaignSection.php`
    - Свойства:
      - `name` - название раздела
      - `status` - статус раздела
      - `type` - тип раздела
      - `content` - содержимое раздела (JSON)
      - `settings` - настройки раздела (JSON)
      - `campaign_id` - ID кампании
    - Отношения:
      - `campaign()` - связь с кампанией
      - `logs()` - связь с логами
    - Методы:
      - `scopeActive()` - область видимости активных разделов
      - `scopeByCampaign()` - фильтрация по кампании
      - `getContentAttribute()` - получение содержимого
      - `setContentAttribute()` - установка содержимого
      - `getSettingsAttribute()` - получение настроек
      - `setSettingsAttribute()` - установка настроек
      - `validateContent()` - валидация содержимого
      - `validateSettings()` - валидация настроек
      - `getStatistics()` - получение статистики
      - `updateStatus()` - обновление статуса
      - `syncWithYandex()` - синхронизация с Яндекс.Директ

  - `DirectTemplatesCampaignLog.php`
    - Свойства:
      - `level` - уровень лога
      - `message` - сообщение
      - `context` - контекст (JSON)
      - `campaign_id` - ID кампании
      - `section_id` - ID раздела (опционально)
    - Отношения:
      - `campaign()` - связь с кампанией
      - `section()` - связь с разделом
    - Методы:
      - `scopeByLevel()` - фильтрация по уровню
      - `scopeByCampaign()` - фильтрация по кампании
      - `scopeBySection()` - фильтрация по разделу
      - `getContextAttribute()` - получение контекста
      - `setContextAttribute()` - установка контекста
      - `formatMessage()` - форматирование сообщения
      - `clearOldLogs()` - очистка старых логов

  - `DirectTemplatesCampaignAnalytics.php`
    - Свойства:
      - `date` - дата
      - `metrics` - метрики (JSON)
      - `campaign_id` - ID кампании
      - `section_id` - ID раздела (опционально)
    - Отношения:
      - `campaign()` - связь с кампанией
      - `section()` - связь с разделом
    - Методы:
      - `scopeByDate()` - фильтрация по дате
      - `scopeByCampaign()` - фильтрация по кампании
      - `scopeBySection()` - фильтрация по разделу
      - `getMetricsAttribute()` - получение метрик
      - `setMetricsAttribute()` - установка метрик
      - `calculateMetrics()` - расчет метрик
      - `generateReport()` - генерация отчета
      - `exportData()` - экспорт данных

  - `DirectTemplatesCampaignSync.php`
    - Свойства:
      - `status` - статус синхронизации
      - `last_sync` - время последней синхронизации
      - `sync_data` - данные синхронизации (JSON)
      - `campaign_id` - ID кампании
    - Отношения:
      - `campaign()` - связь с кампанией
    - Методы:
      - `scopeByStatus()` - фильтрация по статусу
      - `scopeByCampaign()` - фильтрация по кампании
      - `getSyncDataAttribute()` - получение данных синхронизации
      - `setSyncDataAttribute()` - установка данных синхронизации
      - `startSync()` - запуск синхронизации
      - `checkStatus()` - проверка статуса
      - `forceSync()` - принудительная синхронизация
      - `clearSyncData()` - очистка данных синхронизации

### Services
- `app/Services/`
  - `YandexDirect/`
    - `CampaignService.php` - сервис для работы с кампаниями
    - `TemplateService.php` - сервис для работы с шаблонами
    - `SectionService.php` - сервис для работы с разделами

### Providers
- `app/Providers/`
  - `AppServiceProvider.php` - основной сервис-провайдер
  - `RouteServiceProvider.php` - провайдер маршрутов
  - `AuthServiceProvider.php` - провайдер аутентификации

### Exceptions
- `app/Exceptions/`
  - `Handler.php` - обработчик исключений
  - `YandexDirect/`
    - `CampaignException.php` - исключения для кампаний
    - `TemplateException.php` - исключения для шаблонов

### Console
- `app/Console/`
  - `Commands/`
    - `YandexDirect/`
      - `SyncCampaignsCommand.php` - команда синхронизации кампаний
      - `SyncTemplatesCommand.php` - команда синхронизации шаблонов
  - `Kernel.php` - ядро консольных команд

### Http
- `app/Http/`
  - `Controllers/`
    - `Boss/`
      - `DirectTemplateController.php`
        - `index()`
          - Отображение списка всех шаблонов
          - Пагинация результатов
          - Фильтрация по статусу и типу
          - Сортировка по дате создания/обновления
        - `create()`
          - Отображение формы создания шаблона
          - Загрузка начальных данных
          - Валидация прав доступа
        - `store()`
          - Валидация входных данных
          - Создание нового шаблона
          - Привязка к пользователю
          - Логирование действий
        - `show()`
          - Отображение деталей шаблона
          - Загрузка связанных кампаний
          - Статистика использования
        - `edit()`
          - Форма редактирования шаблона
          - Загрузка текущих данных
          - Проверка возможности редактирования
        - `update()`
          - Валидация обновленных данных
          - Обновление шаблона
          - Обработка связанных данных
        - `destroy()`
          - Проверка возможности удаления
          - Удаление шаблона и связанных данных
          - Очистка кэша
      - `DirectTemplatesCampaignController.php`
        - `index()`
          - Список кампаний шаблона
          - Фильтрация по статусу
          - Группировка по типам
          - Статистика по кампаниям
        - `create()`
          - Форма создания кампании
          - Загрузка доступных стратегий
          - Начальные настройки
        - `store()`
          - Валидация данных кампании
          - Создание кампании
          - Инициализация разделов
          - Настройка уведомлений
        - `show()`
          - Детальная информация о кампании
          - Статистика эффективности
          - История изменений
        - `settings()`
          - Основные настройки кампании
          - Валидация параметров
          - Обновление конфигурации
        - `update()`
          - Обновление данных кампании
          - Проверка совместимости
          - Синхронизация с Яндекс.Директ
        - `schedule()`
          - Настройка расписания
          - Валидация временных слотов
          - Обновление периодов показа
        - `restrictions()`
          - Управление ограничениями
          - Настройка таргетинга
          - Гео-ограничения
        - `corrections()`
          - Корректировки ставок
          - Модификаторы
          - Правила корректировок
        - `additionalSettings()`
          - Дополнительные параметры
          - Расширенные настройки
          - Специальные опции
        - `destroy()`
          - Проверка возможности удаления
          - Удаление кампании
          - Очистка связанных данных
      - `DirectTemplatesCampaignSectionController.php`
        - `index()`
          - Список разделов кампании
          - Группировка по типам
          - Статистика по разделам
        - `create()`
          - Форма создания раздела
          - Выбор типа раздела
          - Начальные настройки
        - `store()`
          - Валидация данных раздела
          - Создание раздела
          - Привязка к кампании
        - `show()`
          - Детали раздела
          - Статистика эффективности
          - История изменений
        - `edit()`
          - Форма редактирования
          - Текущие настройки
          - Доступные опции
        - `update()`
          - Обновление раздела
          - Валидация изменений
          - Синхронизация данных
        - `destroy()`
          - Удаление раздела
          - Проверка зависимостей
          - Очистка данных
        - `updateStatus()`
          - Изменение статуса
          - Валидация перехода
          - Логирование изменений
      - `DirectTemplatesCampaignStrategyController.php`
        - `update()`
          - Обновление стратегии
          - Валидация параметров
          - Проверка совместимости
        - `getParameters()`
          - Получение параметров
          - Валидация значений
          - Форматирование данных
      - `DirectTemplatesCampaignPlatformController.php`
        - `update()`
          - Обновление платформ
          - Проверка доступности
          - Синхронизация настроек
        - `getAvailablePlatforms()`
          - Список доступных платформ
          - Фильтрация по типу
          - Статус доступности
      - `DirectTemplatesCampaignBudgetController.php`
        - `update()`
          - Обновление бюджета
          - Валидация лимитов
          - Расчет распределения
        - `getStatistics()`
          - Статистика расходов
          - Анализ эффективности
          - Прогноз бюджета
      - `DirectTemplatesCampaignNotificationController.php`
        - `update()`
          - Настройка уведомлений
          - Выбор каналов
          - Установка триггеров
        - `sendTestNotification()`
          - Отправка тестового уведомления
          - Проверка доставки
          - Логирование результата
      - `DirectTemplatesCampaignExportController.php`
        - `export()`
          - Экспорт данных
          - Форматирование вывода
          - Генерация файла
        - `import()`
          - Импорт данных
          - Валидация формата
          - Обработка ошибок
      - `DirectTemplatesCampaignLogController.php`
        - `index()`
          - Просмотр логов
          - Фильтрация по типу
          - Поиск по параметрам
        - `show()`
          - Детали записи лога
          - Контекст события
          - Связанные данные
        - `clear()`
          - Очистка логов
          - Архивирование данных
          - Очистка кэша
      - `DirectTemplatesCampaignAnalyticsController.php`
        - `index()`
          - Аналитика кампании
          - Сбор метрик
          - Формирование отчетов
        - `getStatistics()`
          - Получение статистики
          - Агрегация данных
          - Расчет показателей
        - `exportReport()`
          - Экспорт отчета
          - Форматирование данных
          - Генерация документа
      - `DirectTemplatesCampaignSyncController.php`
        - `sync()`
          - Синхронизация данных
          - Проверка изменений
          - Обновление статусов
        - `getSyncStatus()`
          - Статус синхронизации
          - Прогресс операции
          - Ошибки синхронизации
        - `forceSync()`
          - Принудительная синхронизация
          - Сброс кэша
          - Обновление всех данных
      - `DirectTemplatesCampaignValidationController.php`
        - `validate()`
          - Валидация кампании
          - Проверка правил
          - Формирование отчетов
        - `getValidationRules()`
          - Получение правил
          - Фильтрация по типу
          - Актуальные ограничения
        - `checkCompatibility()`
          - Проверка совместимости
          - Анализ конфликтов
          - Рекомендации по исправлению
  - `Middleware/`
    - `Authenticate.php` - middleware аутентификации
    - `CheckBossAccess.php` - middleware проверки прав доступа
  - `Requests/`
    - `Boss/`
      - `DirectTemplate/`
        - `StoreRequest.php` - валидация создания шаблона
        - `UpdateRequest.php` - валидация обновления шаблона
      - `Campaign/`
        - `StoreRequest.php` - валидация создания кампании
        - `UpdateRequest.php` - валидация обновления кампании
  - `Resources/`
    - `CampaignResource.php` - ресурс для API кампаний
    - `TemplateResource.php` - ресурс для API шаблонов
  - `Kernel.php` - ядро HTTP-запросов

### View
- `app/View/`
  - `Components/`
    - `YandexDirect/`
      - `Campaign/`
        - `BasicSettings.php`
          - `render()` - отрисовка базовых настроек
          - `getDefaultValues()` - получение значений по умолчанию
          - `validateInput()` - валидация введенных данных
        - `AdvancedSettings.php`
          - `render()` - отрисовка расширенных настроек
          - `getStrategyOptions()` - получение опций стратегий
          - `getPlatformOptions()` - получение опций платформ
        - `Sidebar.php`
          - `render()` - отрисовка бокового меню
          - `getMenuItems()` - получение пунктов меню
          - `isActive()` - проверка активного пункта
        - `Schedule.php`
          - `render()` - отрисовка расписания
          - `getTimeSlots()` - получение временных слотов
          - `validateSchedule()` - валидация расписания
        - `Restrictions.php`
          - `render()` - отрисовка ограничений
          - `getRestrictionTypes()` - получение типов ограничений
          - `validateRestrictions()` - валидация ограничений
        - `Corrections.php`
          - `render()` - отрисовка корректировок
          - `getCorrectionTypes()` - получение типов корректировок
          - `validateCorrections()` - валидация корректировок
        - `AdditionalSettings.php`
          - `render()` - отрисовка дополнительных настроек
          - `getNotificationOptions()` - получение опций уведомлений
          - `validateSettings()` - валидация настроек
        - `Budget.php`
          - `render()` - отрисовка настроек бюджета
          - `getBudgetTypes()` - получение типов бюджета
          - `validateBudget()` - валидация бюджета
        - `Statistics.php`
          - `render()` - отрисовка статистики
          - `getMetrics()` - получение метрик
          - `formatData()` - форматирование данных
        - `Logs.php`
          - `render()` - отрисовка логов
          - `getLogLevels()` - получение уровней логов
          - `formatLogEntry()` - форматирование записи лога
        - `Analytics.php`
          - `render()` - отрисовка аналитики
          - `getCharts()` - получение графиков
          - `getReports()` - получение отчетов
        - `Validation.php`
          - `render()` - отрисовка результатов валидации
          - `getValidationRules()` - получение правил валидации
          - `formatErrors()` - форматирование ошибок
        - `Sync.php`
          - `render()` - отрисовка статуса синхронизации
          - `getSyncStatus()` - получение статуса
          - `formatSyncData()` - форматирование данных синхронизации
        - `Export.php`
          - `render()` - отрисовка опций экспорта
          - `getExportFormats()` - получение форматов экспорта
          - `validateExportOptions()` - валидация опций экспорта
        - `Import.php`
          - `render()` - отрисовка опций импорта
          - `getImportFormats()` - получение форматов импорта
          - `validateImportData()` - валидация импортируемых данных
        - `Notifications.php`
          - `render()` - отрисовка настроек уведомлений
          - `getNotificationTypes()` - получение типов уведомлений
          - `validateNotificationSettings()` - валидация настроек
        - `Platforms.php`
          - `render()` - отрисовка настроек платформ
          - `getAvailablePlatforms()` - получение доступных платформ
          - `validatePlatformSettings()` - валидация настроек
        - `Strategy.php`
          - `render()` - отрисовка настроек стратегии
          - `getStrategyTypes()` - получение типов стратегий
          - `validateStrategySettings()` - валидация настроек
        - `Debug.php`
          - `render()` - отрисовка отладочной информации
          - `getDebugData()` - получение отладочных данных
          - `formatDebugOutput()` - форматирование вывода

## Основные директории

### Контроллеры
- `app/Http/Controllers/Boss/`
  - `DirectTemplateController.php`
    - `index()`
      - Отображение списка всех шаблонов
      - Пагинация результатов
      - Фильтрация по статусу и типу
      - Сортировка по дате создания/обновления
    - `create()`
      - Отображение формы создания шаблона
      - Загрузка начальных данных
      - Валидация прав доступа
    - `store()`
      - Валидация входных данных
      - Создание нового шаблона
      - Привязка к пользователю
      - Логирование действий
    - `show()`
      - Отображение деталей шаблона
      - Загрузка связанных кампаний
      - Статистика использования
    - `edit()`
      - Форма редактирования шаблона
      - Загрузка текущих данных
      - Проверка возможности редактирования
    - `update()`
      - Валидация обновленных данных
      - Обновление шаблона
      - Обработка связанных данных
    - `destroy()`
      - Проверка возможности удаления
      - Удаление шаблона и связанных данных
      - Очистка кэша

  - `DirectTemplatesCampaignController.php`
    - `index()`
      - Список кампаний шаблона
      - Фильтрация по статусу
      - Группировка по типам
      - Статистика по кампаниям
    - `create()`
      - Форма создания кампании
      - Загрузка доступных стратегий
      - Начальные настройки
    - `store()`
      - Валидация данных кампании
      - Создание кампании
      - Инициализация разделов
      - Настройка уведомлений
    - `show()`
      - Детальная информация о кампании
      - Статистика эффективности
      - История изменений
    - `settings()`
      - Основные настройки кампании
      - Валидация параметров
      - Обновление конфигурации
    - `update()`
      - Обновление данных кампании
      - Проверка совместимости
      - Синхронизация с Яндекс.Директ
    - `schedule()`
      - Настройка расписания
      - Валидация временных слотов
      - Обновление периодов показа
    - `restrictions()`
      - Управление ограничениями
      - Настройка таргетинга
      - Гео-ограничения
    - `corrections()`
      - Корректировки ставок
      - Модификаторы
      - Правила корректировок
    - `additionalSettings()`
      - Дополнительные параметры
      - Расширенные настройки
      - Специальные опции
    - `destroy()`
      - Проверка возможности удаления
      - Удаление кампании
      - Очистка связанных данных

  - `DirectTemplatesCampaignSectionController.php`
    - `index()`
      - Список разделов кампании
      - Группировка по типам
      - Статистика по разделам
    - `create()`
      - Форма создания раздела
      - Выбор типа раздела
      - Начальные настройки
    - `store()`
      - Валидация данных раздела
      - Создание раздела
      - Привязка к кампании
    - `show()`
      - Детали раздела
      - Статистика эффективности
      - История изменений
    - `edit()`
      - Форма редактирования
      - Текущие настройки
      - Доступные опции
    - `update()`
      - Обновление раздела
      - Валидация изменений
      - Синхронизация данных
    - `destroy()`
      - Удаление раздела
      - Проверка зависимостей
      - Очистка данных
    - `updateStatus()`
      - Изменение статуса
      - Валидация перехода
      - Логирование изменений

  - `DirectTemplatesCampaignStrategyController.php`
    - `update()`
      - Обновление стратегии
      - Валидация параметров
      - Проверка совместимости
    - `getParameters()`
      - Получение параметров
      - Валидация значений
      - Форматирование данных

  - `DirectTemplatesCampaignPlatformController.php`
    - `update()`
      - Обновление платформ
      - Проверка доступности
      - Синхронизация настроек
    - `getAvailablePlatforms()`
      - Список доступных платформ
      - Фильтрация по типу
      - Статус доступности

  - `DirectTemplatesCampaignBudgetController.php`
    - `update()`
      - Обновление бюджета
      - Валидация лимитов
      - Расчет распределения
    - `getStatistics()`
      - Статистика расходов
      - Анализ эффективности
      - Прогноз бюджета

  - `DirectTemplatesCampaignNotificationController.php`
    - `update()`
      - Настройка уведомлений
      - Выбор каналов
      - Установка триггеров
    - `sendTestNotification()`
      - Отправка тестового уведомления
      - Проверка доставки
      - Логирование результата

  - `DirectTemplatesCampaignExportController.php`
    - `export()`
      - Экспорт данных
      - Форматирование вывода
      - Генерация файла
    - `import()`
      - Импорт данных
      - Валидация формата
      - Обработка ошибок

  - `DirectTemplatesCampaignLogController.php`
    - `index()`
      - Просмотр логов
      - Фильтрация по типу
      - Поиск по параметрам
    - `show()`
      - Детали записи лога
      - Контекст события
      - Связанные данные
    - `clear()`
      - Очистка логов
      - Архивирование данных
      - Очистка кэша

  - `DirectTemplatesCampaignAnalyticsController.php`
    - `index()`
      - Аналитика кампании
      - Сбор метрик
      - Формирование отчетов
    - `getStatistics()`
      - Получение статистики
      - Агрегация данных
      - Расчет показателей
    - `exportReport()`
      - Экспорт отчета
      - Форматирование данных
      - Генерация документа

  - `DirectTemplatesCampaignSyncController.php`
    - `sync()`
      - Синхронизация данных
      - Проверка изменений
      - Обновление статусов
    - `getSyncStatus()`
      - Статус синхронизации
      - Прогресс операции
      - Ошибки синхронизации
    - `forceSync()`
      - Принудительная синхронизация
      - Сброс кэша
      - Обновление всех данных

  - `DirectTemplatesCampaignValidationController.php`
    - `validate()`
      - Валидация кампании
      - Проверка правил
      - Формирование отчетов
    - `getValidationRules()`
      - Получение правил
      - Фильтрация по типу
      - Актуальные ограничения
    - `checkCompatibility()`
      - Проверка совместимости
      - Анализ конфликтов
      - Рекомендации по исправлению

### Модели
- `app/Models/`
  - `DirectTemplate.php` - модель шаблона
  - `DirectTemplatesCampaign.php` - модель кампании
  - `DirectTemplatesCampaignSection.php` - модель раздела кампании

### Представления
- `resources/views/boss/direct-templates/`
  - `campaigns/`
    - `settings.blade.php` - настройки кампании
    - `schedule.blade.php` - расписание кампании
    - `restrictions.blade.php` - ограничения кампании
    - `corrections.blade.php` - корректировки кампании
    - `additional-settings.blade.php` - дополнительные настройки
    - `show.blade.php` - просмотр кампании
  - `components/`
    - `container.blade.php` - контейнер для шаблонов
  - `index.blade.php` - список шаблонов
  - `show.blade.php` - просмотр шаблона

### Компоненты
- `resources/views/components/yandex-direct/campaigns/`
  - `basic-settings.blade.php` - базовые настройки кампании
  - `advanced-settings.blade.php` - расширенные настройки кампании
  - `sidebar.blade.php` - боковое меню кампании
  - `additional-settings.blade.php` - дополнительные настройки

### Миграции
- `database/migrations/`
  - `2024_03_19_000001_create_direct_templates_table.php` - создание таблицы шаблонов
  - `2024_03_19_000002_add_strategy_fields_to_direct_templates_campaigns_table.php` - добавление полей стратегии
  - `2024_03_19_000003_create_direct_templates_campaigns_table.php` - создание таблицы кампаний
  - `2024_03_19_000004_create_direct_templates_campaign_sections_table.php` - создание таблицы разделов

### Маршруты
- `routes/web.php` - определение маршрутов приложения

## Основные функциональные блоки

### Шаблоны (Direct Templates)
- Создание шаблонов
- Просмотр списка шаблонов
- Просмотр деталей шаблона
- Управление кампаниями в шаблоне

### Кампании (Campaigns)
- Создание кампаний
- Настройки кампании:
  - Базовые настройки
  - Расширенные настройки
  - Расписание
  - Ограничения
  - Корректировки
  - Дополнительные настройки
- Просмотр деталей кампании

### Разделы кампаний (Campaign Sections)
- Управление разделами кампании
- Отслеживание статуса разделов

## Технические особенности

### Отладка
- Включена отладочная информация для форм (при APP_DEBUG=true)
- Отображение:
  - Текущих данных
  - Отправляемых данных
  - Ответа сервера

### Безопасность
- CSRF-защита для всех форм
- Валидация входных данных
- Проверка прав доступа

### Интерфейс
- Адаптивный дизайн
- Интерактивные формы
- Валидация на стороне клиента
- Динамическое обновление параметров стратегии 